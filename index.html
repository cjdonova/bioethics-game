<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BioEthics Adventure - Complex Scenarios</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #dbeafe 0%, #f3e8ff 100%); }
        .consequence-positive { background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%); border-left: 4px solid #10b981; }
        .consequence-negative { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-left: 4px solid #ef4444; }
        .consequence-mixed { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-left: 4px solid #f59e0b; }
        .stakeholder-card { transition: all 0.3s ease; }
        .stakeholder-card:hover { transform: scale(1.02); }
        .choice-btn { transition: all 0.3s ease; }
        .choice-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div id="app" class="max-w-6xl mx-auto p-6">
        
        <!-- Start Screen -->
        <div id="startScreen" class="text-center">
            <h1 class="text-5xl font-bold text-gray-800 mb-4">BioEthics Adventure</h1>
            <p class="text-xl text-gray-600 mb-8">Navigate multi-layered ethical dilemmas with cascading consequences</p>
            
            <div class="bg-white rounded-lg shadow-xl p-8 max-w-4xl mx-auto">
                <div class="mb-8">
                    <h3 class="text-2xl font-semibold mb-4 text-gray-800">🌊 Complex Decision Trees</h3>
                    <p class="text-gray-700 leading-relaxed mb-6">
                        Each scenario now contains 4-6 interconnected decision points. Your choices create stakeholder reactions, 
                        new complications, and emergent ethical dilemmas that require additional decisions.
                    </p>
                </div>
                
                <div class="grid grid-cols-2 gap-6 mb-8">
                    <div class="text-center">
                        <div class="text-4xl mb-3">🎭</div>
                        <h4 class="font-semibold text-gray-800">Multiple Stakeholders</h4>
                        <p class="text-sm text-gray-600">Patients, families, staff, media, regulators all react differently</p>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-3">⚡</div>
                        <h4 class="font-semibold text-gray-800">Cascading Effects</h4>
                        <p class="text-sm text-gray-600">Each decision creates new situations requiring further choices</p>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-3">🔄</div>
                        <h4 class="font-semibold text-gray-800">Emergent Dilemmas</h4>
                        <p class="text-sm text-gray-600">New ethical challenges emerge from your previous decisions</p>
                    </div>
                    <div class="text-center">
                        <div class="text-4xl mb-3">📊</div>
                        <h4 class="font-semibold text-gray-800">Impact Tracking</h4>
                        <p class="text-sm text-gray-600">See real-time effects on all stakeholder groups</p>
                    </div>
                </div>
                
                <button onclick="startAdventure()" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-12 py-4 rounded-lg font-semibold text-lg hover:transform hover:scale-105 transition-all shadow-lg">
                    🚀 Begin Complex Journey
                </button>
            </div>
        </div>

        <!-- Story Screen -->
        <div id="storyScreen" style="display: none;">
            <div class="bg-white rounded-lg shadow-xl p-8 mb-6">
                <!-- Header -->
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-800" id="storyTitle">The Gene Therapy Crisis</h1>
                        <div class="flex items-center mt-2">
                            <span id="storyIcon" class="text-2xl mr-3">🧬</span>
                            <span id="storyRole" class="text-lg text-blue-600 font-medium">Chief Medical Officer</span>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-600">Step <span id="stepNumber">1</span> of <span id="totalSteps">5</span></div>
                        <div class="text-lg font-semibold text-purple-600" id="ethicsScore">Ethics Score: 100</div>
                    </div>
                </div>

                <!-- Current Situation -->
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 mb-6">
                    <h3 class="font-semibold text-gray-800 mb-3 text-lg">📖 Current Situation</h3>
                    <p id="storyText" class="text-gray-700 leading-relaxed text-lg"></p>
                </div>

                <!-- Stakeholder Reactions -->
                <div id="stakeholderSection" style="display: none;" class="mb-6">
                    <h3 class="font-semibold text-gray-800 mb-3 text-lg">👥 Stakeholder Status</h3>
                    <div id="stakeholderGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
                </div>

                <!-- Previous Consequences -->
                <div id="consequencesContainer" style="display: none;" class="mb-6">
                    <h3 class="font-semibold text-gray-800 mb-3 text-lg">⚡ Consequences of Your Last Decision</h3>
                    <div id="consequencesList"></div>
                </div>

                <!-- Character Input -->
                <div id="inputSection" class="bg-gray-50 rounded-lg p-6 mb-6">
                    <h3 class="font-semibold text-gray-800 mb-3">💭 Your Strategic Thinking</h3>
                    <textarea id="playerInput" placeholder="What factors are you weighing? What are your primary concerns? How do you balance competing interests?" class="w-full p-3 border border-gray-300 rounded-lg resize-none" rows="3"></textarea>
                    <div class="text-sm text-gray-600 mt-2">Your reasoning will influence the story and be tracked throughout.</div>
                </div>

                <!-- Choices -->
                <div class="space-y-4">
                    <h3 class="font-semibold text-gray-800 mb-4 text-lg">🤔 What is your decision?</h3>
                    <div id="choicesContainer"></div>
                </div>
            </div>

            <!-- Context Panel -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="font-semibold text-gray-800 mb-3">🎯 Ethical Framework</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                    <div class="bg-blue-50 p-3 rounded">
                        <strong>Autonomy:</strong> Respecting individual choice and self-determination
                    </div>
                    <div class="bg-green-50 p-3 rounded">
                        <strong>Beneficence:</strong> Acting to benefit patients and promote welfare
                    </div>
                    <div class="bg-purple-50 p-3 rounded">
                        <strong>Justice:</strong> Fair distribution of benefits, risks, and costs
                    </div>
                    <div class="bg-yellow-50 p-3 rounded">
                        <strong>Non-maleficence:</strong> "Do no harm" - avoiding negative consequences
                    </div>
                </div>
            </div>
        </div>

        <!-- Final Outcome -->
        <div id="outcomeScreen" style="display: none;">
            <div class="bg-white rounded-lg shadow-xl p-8">
                <div class="text-center mb-8">
                    <div id="finalIcon" class="text-6xl mb-4">🎯</div>
                    <h2 class="text-4xl font-bold text-gray-800 mb-4">Your Complex Journey Concludes</h2>
                    <div id="finalTitle" class="text-2xl font-semibold text-blue-600 mb-2">Ethical Navigator</div>
                    <div class="text-lg">Final Ethics Score: <span id="finalScore" class="font-bold text-purple-600">85/100</span></div>
                </div>

                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 mb-8">
                    <h3 class="font-semibold text-gray-800 mb-3 text-lg">📚 Your Leadership Legacy</h3>
                    <div id="outcomeText" class="text-gray-700 leading-relaxed"></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-4 text-lg">🛤️ Your Decision Path</h3>
                        <div id="decisionSummary" class="space-y-3 max-h-96 overflow-y-auto"></div>
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-800 mb-4 text-lg">🧠 Your Strategic Reasoning</h3>
                        <div id="reflectionSummary" class="bg-gray-50 rounded-lg p-4 max-h-96 overflow-y-auto"></div>
                    </div>
                </div>

                <div class="text-center">
                    <button onclick="resetAdventure()" class="bg-gradient-to-r from-green-600 to-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:transform hover:scale-105 transition-all shadow-lg mr-4">
                        🔄 Explore Different Paths
                    </button>
                    <button onclick="shareStory()" class="bg-gradient-to-r from-purple-600 to-pink-600 text-white px-8 py-3 rounded-lg font-semibold hover:transform hover:scale-105 transition-all shadow-lg">
                        📤 Share Your Journey
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const gameState = {
            currentStep: 1,
            totalSteps: 5,
            ethicsScore: 100,
            decisions: [],
            reflections: [],
            consequences: [],
            stakeholders: {
                patients: { mood: 50, name: "Patients" },
                families: { mood: 50, name: "Families" },
                staff: { mood: 50, name: "Medical Staff" },
                media: { mood: 50, name: "Media" },
                board: { mood: 50, name: "Hospital Board" },
                regulators: { mood: 50, name: "Regulators" }
            },
            scenarioPath: []
        };

        const scenario = {
            title: "The Gene Therapy Crisis",
            icon: "🧬",
            role: "Chief Medical Officer",
            steps: [
                {
                    // Step 1 - Initial Crisis
                    text: "URGENT: You're the Chief Medical Officer at Regional Medical Center. A breakthrough gene therapy costing $2.1 million per treatment can cure Spinal Muscular Atrophy, a fatal genetic disease. You have 22 children who desperately need it, but your annual budget only covers 4 treatments. Families are pleading, media is investigating, and the hospital board wants a decision within 48 hours. Your choice will set the precedent for all future allocation decisions.",
                    stakeholderReactions: {
                        patients: { concern: "Want immediate access to life-saving treatment" },
                        families: { concern: "Desperate to save their children's lives" },
                        staff: { concern: "Want to help but understand budget constraints" },
                        media: { concern: "Investigating fairness and transparency" },
                        board: { concern: "Balancing compassion with financial responsibility" },
                        regulators: { concern: "Ensuring compliance with medical ethics" }
                    },
                    choices: [
                        {
                            text: "Create transparent medical committee to rank by severity and prognosis",
                            nextStep: 1,
                            path: "medical_triage",
                            consequence: {
                                type: "mixed",
                                immediate: "You establish a 5-person ethics committee that spends 36 hours reviewing all cases. They create objective medical criteria ranking patients by disease progression, age, and likelihood of success.",
                                stakeholderEffects: { patients: +5, families: -5, staff: +15, media: +10, board: +10, regulators: +15 },
                                ethicsChange: 8
                            }
                        },
                        {
                            text: "Launch emergency fundraising while treating 4 most critical patients immediately",
                            nextStep: 1,
                            path: "fundraising",
                            consequence: {
                                type: "positive",
                                immediate: "You begin treating the 4 sickest children immediately while launching '22 Children, One Hope' campaign. Local media embraces the story, and donations start flowing within hours.",
                                stakeholderEffects: { patients: +15, families: +20, staff: +10, media: +20, board: +5, regulators: +5 },
                                ethicsChange: 10
                            }
                        },
                        {
                            text: "Implement fair lottery system for all 22 children",
                            nextStep: 1,
                            path: "lottery",
                            consequence: {
                                type: "negative",
                                immediate: "You announce a lottery. The family of Emma (age 3, most critical case) is outraged: 'You're gambling with lives!' The story goes viral with #SaveEmma trending. Medical ethicists debate your approach.",
                                stakeholderEffects: { patients: -15, families: -25, staff: -5, media: -10, board: 0, regulators: +10 },
                                ethicsChange: -5
                            }
                        }
                    ]
                },
                {
                    // Step 2 - Complications arise
                    medical_triage: {
                        text: "The ethics committee ranked all patients by medical criteria. The top 4 are clear, but complications emerge: #5 is Marcus, whose grandmother is threatening to withdraw her $5 million hospital donation if he's not treated. #6 is the child of Dr. Sarah Chen, your head of pediatrics, who has remained professionally silent but is clearly devastated. A whistleblower leaked the donor pressure to investigative reporters. How do you handle this ethical minefield?",
                        stakeholderReactions: {
                            patients: { concern: "Worried about fair treatment vs. donor influence" },
                            families: { concern: "Fear that money talks louder than medical need" },
                            staff: { concern: "Dr. Chen's situation creating workplace tension" },
                            media: { concern: "Major story about healthcare corruption brewing" },
                            board: { concern: "Torn between ethics and losing major funding" },
                            regulators: { concern: "Investigating potential conflicts of interest" }
                        },
                        choices: [
                            {
                                text: "Maintain strict medical ranking publicly, lose the $5M donation",
                                nextStep: 2,
                                consequence: {
                                    type: "positive",
                                    immediate: "You hold a televised press conference explaining your medical criteria. The donor withdraws funding angrily, but 18 other families publicly praise your integrity. Dr. Chen quietly thanks you.",
                                    stakeholderEffects: { patients: +20, families: +25, staff: +20, media: +25, board: -15, regulators: +20 },
                                    ethicsChange: 15
                                }
                            },
                            {
                                text: "Find $2.1M elsewhere to create a 5th slot for Marcus",
                                nextStep: 2,
                                consequence: {
                                    type: "mixed",
                                    immediate: "You reallocate funds from the cardiac wing renovation, delaying it 2 years. Marcus gets treated, donation is saved, but cardiac patients will suffer delayed care. Staff question the precedent.",
                                    stakeholderEffects: { patients: +5, families: +10, staff: -5, media: +5, board: +15, regulators: 0 },
                                    ethicsChange: 3
                                }
                            },
                            {
                                text: "Quietly adjust ranking citing 'additional medical factors'",
                                nextStep: 2,
                                consequence: {
                                    type: "negative",
                                    immediate: "You subtly move Marcus to #4. The $5M is secured, but Dr. Chen resigns in protest. The ethics committee members feel betrayed. Media discovers the manipulation within days.",
                                    stakeholderEffects: { patients: -20, families: -25, staff: -30, media: -35, board: +20, regulators: -30 },
                                    ethicsChange: -20
                                }
                            }
                        ]
                    },
                    fundraising: {
                        text: "Your campaign has raised $6.3 million in 10 days! You can now treat 7 additional children (11 total). However, success brings new problems: GeneTech Industries raises prices 20% citing 'market demand.' 40 new families from nationwide have applied. The State Attorney General is investigating whether your program creates unfair interstate healthcare access. Other hospitals are pressuring you to share your fundraising methods. What's your strategic response?",
                        stakeholderReactions: {
                            patients: { concern: "Hope for expanded access but worried about new barriers" },
                            families: { concern: "New families want in, original families fear diluted resources" },
                            staff: { concern: "Overwhelmed by success and new administrative burden" },
                            media: { concern: "Investigating pricing manipulation and interstate equity" },
                            board: { concern: "Excited by success but worried about legal challenges" },
                            regulators: { concern: "Ensuring program doesn't violate interstate commerce rules" }
                        },
                        choices: [
                            {
                                text: "Create consortium with other hospitals to share model and reduce costs",
                                nextStep: 2,
                                consequence: {
                                    type: "positive",
                                    immediate: "You organize 8 regional hospitals into a purchasing consortium. Combined power negotiates GeneTech down to original prices and creates sustainable model for 50+ children annually.",
                                    stakeholderEffects: { patients: +25, families: +20, staff: +15, media: +20, board: +15, regulators: +25 },
                                    ethicsChange: 18
                                }
                            },
                            {
                                text: "Keep program local, fight price increase through legal channels",
                                nextStep: 2,
                                consequence: {
                                    type: "mixed",
                                    immediate: "You file antitrust lawsuit against GeneTech while limiting program to original 22 children. Legal battle delays treatments 6 months but could set national precedent for fair pricing.",
                                    stakeholderEffects: { patients: -10, families: -5, staff: +5, media: +15, board: +5, regulators: +15 },
                                    ethicsChange: 8
                                }
                            },
                            {
                                text: "Accept higher prices, limit to best-funded families",
                                nextStep: 2,
                                consequence: {
                                    type: "negative",
                                    immediate: "You pay GeneTech's inflated prices but can only afford 9 of your original 22 children. Families of excluded children file discrimination lawsuits. Program becomes elitist.",
                                    stakeholderEffects: { patients: -15, families: -20, staff: -10, media: -20, board: -5, regulators: -15 },
                                    ethicsChange: -12
                                }
                            }
                        ]
                    },
                    lottery: {
                        text: "The lottery controversy has exploded. Emma's family hired a prominent medical malpractice attorney and filed an emergency injunction. #SaveEmma has 3.2 million social media shares. Three board members are calling for your resignation. However, bioethicists from Harvard, Johns Hopkins, and Mayo Clinic published a joint letter supporting lottery systems as the most equitable approach. You're caught between public emotion and expert opinion. The judge will rule in 48 hours. Your next move could save or sink your career.",
                        stakeholderReactions: {
                            patients: { concern: "Confused by conflicting expert vs. public opinion" },
                            families: { concern: "Emma's family vs. other lottery winners in legal battle" },
                            staff: { concern: "Divided loyalty between boss and public pressure" },
                            media: { concern: "Major story about ethics vs. emotion in healthcare" },
                            board: { concern: "Panicked about reputation and legal liability" },
                            regulators: { concern: "Watching case that could set national precedent" }
                        },
                        choices: [
                            {
                                text: "Stand firm on lottery, launch ethics education campaign",
                                nextStep: 2,
                                consequence: {
                                    type: "positive",
                                    immediate: "You partner with medical schools to launch public education on healthcare ethics. Judge rules in your favor. Emma gets slot #2 in lottery. Medical community rallies behind evidence-based ethics.",
                                    stakeholderEffects: { patients: +15, families: +10, staff: +25, media: +20, board: +5, regulators: +25 },
                                    ethicsChange: 20
                                }
                            },
                            {
                                text: "Abandon lottery, switch to medical triage under legal pressure",
                                nextStep: 2,
                                consequence: {
                                    type: "negative",
                                    immediate: "You cave to pressure and switch to medical ranking. Emma gets treated first, but other lottery winners feel betrayed. Medical ethics community condemns the decision as 'mob rule over medicine.'",
                                    stakeholderEffects: { patients: -15, families: -10, staff: -20, media: -15, board: +10, regulators: -20 },
                                    ethicsChange: -15
                                }
                            },
                            {
                                text: "Propose compromise: hybrid system with medical and random elements",
                                nextStep: 2,
                                consequence: {
                                    type: "mixed",
                                    immediate: "You create complex criteria combining medical severity with randomness for equal cases. System is fairer but confusing. Takes 3 weeks to implement while children wait for clarity.",
                                    stakeholderEffects: { patients: +5, families: +5, staff: -5, media: +10, board: +10, regulators: +10 },
                                    ethicsChange: 5
                                }
                            }
                        ]
                    }
                },
                {
                    // Step 3 - New crisis emerges
                    text: "Six months later, your gene therapy program has attracted national attention. The success has led to your promotion to Chief Ethics Officer for the entire hospital system. Now you face a new crisis: the hospital wants to implement an AI diagnostic system that analyzes patients' social media, shopping patterns, and location data to predict heart disease 6 months early. It's 87% accurate and could save 200+ lives annually, but privacy advocates are suing to block it. Your previous gene therapy decisions have shaped how stakeholders view your judgment. The board wants your recommendation in 72 hours.",
                    choices: [
                        {
                            text: "Implement with robust consent process and privacy protections",
                            nextStep: 3,
                            consequence: {
                                type: "positive",
                                immediate: "You design an opt-in system with full transparency and data protection. 35% of patients participate. In year one, you prevent 74 heart attacks and detect 23 early cancers through the AI analysis.",
                                stakeholderEffects: { patients: +15, families: +20, staff: +10, media: +15, board: +20, regulators: +15 },
                                ethicsChange: 12
                            }
                        },
                        {
                            text: "Reject system due to privacy concerns and surveillance risks",
                            nextStep: 3,
                            consequence: {
                                type: "mixed",
                                immediate: "You block the AI system citing privacy rights. However, 38 preventable heart attacks occur in the first year. Families of victims question whether privacy was worth their loved ones' lives.",
                                stakeholderEffects: { patients: -10, families: -15, staff: 0, media: +10, board: -15, regulators: +10 },
                                ethicsChange: 5
                            }
                        },
                        {
                            text: "Pilot program with high-risk patients only",
                            nextStep: 3,
                            consequence: {
                                type: "mixed",
                                immediate: "You implement for diabetes and cardiac patients only. System prevents 31 heart attacks but creates two-tier healthcare. Questions arise about equal access to AI-powered medicine.",
                                stakeholderEffects: { patients: +5, families: +10, staff: +5, media: +5, board: +10, regulators: +5 },
                                ethicsChange: 8
                            }
                        }
                    ]
                },
                {
                    // Step 4 - Global implications
                    text: "Your AI ethics work has caught international attention. BioGenX Corporation offers you the position of Global Chief Ethics Officer. Your first challenge: they've developed a universal flu vaccine that costs $8 per dose to produce, but the board wants to price it at $180 in wealthy countries and $90 in middle-income countries. Low-income countries would get it free through a foundation, but this pricing could still leave 500 million people without access. The World Health Organization is pressuring for global affordable pricing. Shareholders want maximum returns. Your decision will affect global health policy for decades.",
                    choices: [
                        {
                            text: "Implement tiered pricing with wealthy countries subsidizing global access",
                            nextStep: 4,
                            consequence: {
                                type: "positive",
                                immediate: "You negotiate a system where wealthy nations pay premium prices that fund free distribution globally. 2.1 billion people get vaccinated in year one, preventing an estimated 890,000 deaths.",
                                stakeholderEffects: { patients: +25, families: +30, staff: +20, media: +25, board: +10, regulators: +20 },
                                ethicsChange: 20
                            }
                        },
                        {
                            text: "Price at cost globally, fund R&D through public-private partnerships",
                            nextStep: 4,
                            consequence: {
                                type: "mixed",
                                immediate: "You price the vaccine at $12 worldwide, funded by government partnerships. Universal access is achieved but future R&D depends on uncertain public funding. Some breakthrough research is delayed.",
                                stakeholderEffects: { patients: +20, families: +25, staff: +15, media: +20, board: -10, regulators: +15 },
                                ethicsChange: 15
                            }
                        },
                        {
                            text: "Maintain market-based pricing to fund future innovation",
                            nextStep: 4,
                            consequence: {
                                type: "negative",
                                immediate: "You keep high prices to fund next-generation vaccines. Wealthy populations are protected, but 500 million people remain vulnerable. Public health advocates condemn the decision as prioritizing profits over lives.",
                                stakeholderEffects: { patients: -15, families: -20, staff: -10, media: -25, board: +20, regulators: -15 },
                                ethicsChange: -18
                            }
                        }
                    ]
                }
            ]
        };

        function startAdventure() {
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('storyScreen').style.display = 'block';
            loadStep(0);
        }

        function loadStep(stepIndex) {
            gameState.currentStep = stepIndex + 1;
            
            let stepData;
            if (stepIndex === 0) {
                stepData = scenario.steps[0];
            } else if (stepIndex === 1) {
                const path = gameState.scenarioPath[gameState.scenarioPath.length - 1];
                stepData = scenario.steps[1][path];
            } else {
                stepData = scenario.steps[stepIndex];
            }

            document.getElementById('stepNumber').textContent = gameState.currentStep;
            document.getElementById('totalSteps').textContent = gameState.totalSteps;
            document.getElementById('storyTitle').textContent = scenario.title;
            document.getElementById('storyIcon').textContent = scenario.icon;
            document.getElementById('storyRole').textContent = scenario.role;
            document.getElementById('ethicsScore').textContent = `Ethics Score: ${gameState.ethicsScore}`;
            document.getElementById('storyText').textContent = stepData.text;

            // Show stakeholder reactions if available
            if (stepData.stakeholderReactions) {
                showStakeholders(stepData.stakeholderReactions);
            }

            // Show previous consequences if any
            if (gameState.consequences.length > 0) {
                showConsequences();
            } else {
                document.getElementById('consequencesContainer').style.display = 'none';
            }

            // Load choices
            loadChoices(stepData.choices);
        }

        function showStakeholders(reactions) {
            document.getElementById('stakeholderSection').style.display = 'block';
            const grid = document.getElementById('stakeholderGrid');
            grid.innerHTML = '';

            Object.keys(gameState.stakeholders).forEach(key => {
                const stakeholder = gameState.stakeholders[key];
                const reaction = reactions[key];
                
                let moodColor = 'bg-gray-100';
                let moodText = 'Neutral';
                
                if (stakeholder.mood >= 70) { moodColor = 'bg-green-100'; moodText = 'Supportive'; }
